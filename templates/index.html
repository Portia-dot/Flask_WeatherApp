<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="location-info">
            {% if city_info %}
                <div class="location-name">{{ city_info.city }}, {{ city_info.state }}</div>
            {% else %}
                <div class="location-name">London, UK</div>
            {% endif %}
            <div class="current-weather">
                <div class="current-temp">{{ weather.temperature }}</div>
                <div class="weather-condition">{{ weather.clouds}}</div>
            </div>
        </div>
        <form action="" method="POST">
            <div class="search-box">
                <input type="text" name = "user_search" placeholder="Search location...">
            </div>
        </form>

    </div>

    <!-- Middle Section -->
    <div class="middle-section">
        <!-- Left Panel: Weather Details -->
        <div class="weather-details">
            <h3>Current Weather</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Feels Like</div>
                    <div class="detail-value">{{ weather.feels_like }}°C</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Air Quality</div>
                    {% if weather and weather.air_quality %}
                        <div class="detail-value">{{ weather.air_quality.air_quality }}</div>
                    {% else %}
                        <div class="detail-value">Air quality data not available</div>
                    {% endif %}

                </div>
                <div class="detail-item">
                    <div class="detail-label">Humidity</div>
                    <div class="detail-value">{{ weather.humidity }}%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Wind</div>
                    <div class="detail-value">{{ weather.wind }} km/h</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">UV Index</div>
                    <div class="detail-value">{{ weather.uvi }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Pressure</div>
                    <div class="detail-value">{{ weather.pressure }} hPa</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Visibility</div>
                    <div class="detail-value">{{ weather.visibility }} km</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Dew Point</div>
                    <div class="detail-value">{{ weather.dew_point }}°C</div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Map -->
        <div class="map-container">
            <h3>Precipitation Map</h3>
            <div class="map-placeholder">
                <div id="map"></div>
            </div>
            <button class="map-button">Open Map</button>
        </div>

        <!-- Right Panel: Info Box -->
        <div class="info-box">
            <h3>Weather Report</h3>
            <p>{{ weather_ai }}</p>
            <i class="fas fa-cloud-sun fa-3x" style="margin-top: 20px; color: var(--accent-color);"></i>
        </div>
    </div>

    <!-- Tabs Section -->
    <div class="tabs-section">
        <div class="tabs">
            <div class="tab active">Overview</div>
            <div class="tab">Precipitation</div>
            <div class="tab">Wind</div>
            <div class="tab">Air Quality</div>
            <div class="tab">Humidity</div>
            <div class="tab">Cloud Cover</div>
        </div>
    </div>



    <!-- Weather Forecast Charts -->
    <div class="forecast-charts-container">
        <!-- Temperature Chart (Overview) -->
        <div class="weather-forecast-chart active" id="overview-chart">
            <h3>24-Hour Temperature Forecast</h3>

            <!-- Toggle for "Feels Like" temperature -->
            <div class="feels-like-toggle">
                <span>Show "Feels Like" Temperature</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="feelsLikeToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="temperatureChart"></canvas>
            </div>
        </div>

        <!-- Precipitation Chart -->
        <div class="weather-forecast-chart" id="precipitation-chart">
            <h3>24-Hour Precipitation Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="precipitationChart"></canvas>
            </div>
        </div>

        <!-- Wind Chart -->
        <div class="weather-forecast-chart" id="wind-chart">
            <h3>24-Hour Wind Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="windChart"></canvas>
            </div>
        </div>

        <!-- Air Quality Chart -->
        <div class="weather-forecast-chart" id="air-quality-chart">
            <h3>24-Hour Air Quality Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="airQualityChart"></canvas>
            </div>
        </div>

        <!-- Humidity Chart -->
        <div class="weather-forecast-chart" id="humidity-chart">
            <h3>24-Hour Humidity Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="humidityChart"></canvas>
            </div>
        </div>

        <!-- Cloud Cover Chart -->
        <div class="weather-forecast-chart" id="cloud-cover-chart">
            <h3>24-Hour Cloud Cover Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="cloudCoverChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Forecast List View (Hidden by default) -->
    <div class="forecast-list-view" style="display: none;">
        <h3>24-Hour Forecast</h3>
        <div class="forecast-list-container">
            <!-- List items will be generated by JavaScript -->
        </div>
    </div>


        <!-- Forecast Section -->
    <div class="forecast-section">
        <div class="forecast-header">
            <div class="forecast-title">7-Day Forecast</div>
            <div class="view-toggle">
                <button class="toggle-btn active">Chart</button>
                <button class="toggle-btn">List</button>
            </div>
        </div>
        <div class="forecast-cards">
            <!-- Day 1 -->
            <div class="forecast-card">
                <div class="day">Mon</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">19°C</div>
                <div class="temp-low">12°C</div>
            </div>
            <!-- Day 2 -->
            <div class="forecast-card">
                <div class="day">Tue</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">17°C</div>
                <div class="temp-low">11°C</div>
            </div>
            <!-- Day 3 -->
            <div class="forecast-card">
                <div class="day">Wed</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-rain" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">15°C</div>
                <div class="temp-low">10°C</div>
            </div>
            <!-- Day 4 -->
            <div class="forecast-card">
                <div class="day">Thu</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-showers-heavy" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">14°C</div>
                <div class="temp-low">9°C</div>
            </div>
            <!-- Day 5 -->
            <div class="forecast-card">
                <div class="day">Fri</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">16°C</div>
                <div class="temp-low">10°C</div>
            </div>
            <!-- Day 6 -->
            <div class="forecast-card">
                <div class="day">Sat</div>
                <div class="forecast-icon">
                    <i class="fas fa-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">18°C</div>
                <div class="temp-low">12°C</div>
            </div>
            <!-- Day 7 -->
            <div class="forecast-card">
                <div class="day">Sun</div>
                <div class="forecast-icon">
                    <i class="fas fa-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">20°C</div>
                <div class="temp-low">13°C</div>
            </div>
        </div>
    </div>

</div>

<!-- Include the external JavaScript file -->
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<script>
// Map initialization
var map = L.map('map').setView([{{city_info.lat}}, {{city_info.lon}}], 5);

// Base map
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '© OpenStreetMap',
    maxZoom: 10
}).addTo(map);

// Weather overlay
L.tileLayer('{{ tile_url }}', {
    maxZoom: 18,
    opacity: 1
}).addTo(map);

// Fix map display issue by triggering a resize event after the map is loaded
setTimeout(function() {
    map.invalidateSize();
}, 100);
</script>

</body>
</html>