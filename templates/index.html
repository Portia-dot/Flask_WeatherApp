<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="location-info">
            {% if city_info %}
                <div class="location-name">{{ city_info.city }}, {{ city_info.state }}</div>
            {% else %}
                <div class="location-name">London, UK</div>
            {% endif %}
            <div class="current-weather">
                <div class="current-temp">{{ weather.temperature }}</div>
                <div class="weather-condition">{{ weather.clouds}}</div>
            </div>
        </div>
        <form action="" method="POST">
            <div class="search-box">
                <input type="text" name = "user_search" placeholder="Search location...">
            </div>
        </form>

    </div>

    <!-- Middle Section -->
    <div class="middle-section">
        <!-- Left Panel: Weather Details -->
        <div class="weather-details">
            <h3>Current Weather</h3>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Feels Like</div>
                    <div class="detail-value">{{ weather.feels_like }}°C</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Air Quality</div>
                    {% if weather and weather.air_quality %}
                        <div class="detail-value">{{ weather.air_quality.air_quality }}</div>
                    {% else %}
                        <div class="detail-value">Air quality data not available</div>
                    {% endif %}

                </div>
                <div class="detail-item">
                    <div class="detail-label">Humidity</div>
                    <div class="detail-value">{{ weather.humidity }}%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Wind</div>
                    <div class="detail-value">{{ weather.wind }} km/h</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">UV Index</div>
                    <div class="detail-value">{{ weather.uvi }}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Pressure</div>
                    <div class="detail-value">{{ weather.pressure }} hPa</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Visibility</div>
                    <div class="detail-value">{{ weather.visibility }} km</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Dew Point</div>
                    <div class="detail-value">{{ weather.dew_point }}°C</div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Map -->
        <div class="map-container">
            <h3>Precipitation Map</h3>
            <div class="map-placeholder">
                <div id="map"></div>
            </div>
            <button class="map-button">Open Map</button>
        </div>

        <!-- Right Panel: Info Box -->
        <div class="info-box">
            <h3>Weather Report</h3>
            <p>{{ weather_ai }}</p>
            <i class="fas fa-cloud-sun fa-3x" style="margin-top: 20px; color: var(--accent-color);"></i>
        </div>
    </div>

    <!-- Tabs Section -->
    <div class="tabs-section">
        <div class="tabs">
            <div class="tab active">Overview</div>
            <div class="tab">Precipitation</div>
            <div class="tab">Wind</div>
            <div class="tab">Air Quality</div>
            <div class="tab">Humidity</div>
            <div class="tab">Cloud Cover</div>
        </div>
    </div>



    <!-- Weather Forecast Charts -->
    <div class="forecast-charts-container">
        <!-- Temperature Chart (Overview) -->
        <div class="weather-forecast-chart active" id="overview-chart">
            <h3>24-Hour Temperature Forecast</h3>

            <!-- Toggle for "Feels Like" temperature -->
            <div class="feels-like-toggle">
                <span>Show "Feels Like" Temperature</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="feelsLikeToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="temperatureChart"></canvas>
            </div>
        </div>

        <!-- Precipitation Chart -->
        <div class="weather-forecast-chart" id="precipitation-chart">
            <h3>24-Hour Precipitation Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="precipitationChart"></canvas>
            </div>
        </div>

        <!-- Wind Chart -->
        <div class="weather-forecast-chart" id="wind-chart">
            <h3>24-Hour Wind Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="windChart"></canvas>
            </div>
        </div>

        <!-- Air Quality Chart -->
        <div class="weather-forecast-chart" id="air-quality-chart">
            <h3>24-Hour Air Quality Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="airQualityChart"></canvas>
            </div>
        </div>

        <!-- Humidity Chart -->
        <div class="weather-forecast-chart" id="humidity-chart">
            <h3>24-Hour Humidity Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="humidityChart"></canvas>
            </div>
        </div>

        <!-- Cloud Cover Chart -->
        <div class="weather-forecast-chart" id="cloud-cover-chart">
            <h3>24-Hour Cloud Cover Forecast</h3>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="cloudCoverChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Forecast List View (Hidden by default) -->
    <div class="forecast-list-view" style="display: none;">
        <h3>24-Hour Forecast</h3>
        <div class="forecast-list-container">
            <!-- List items will be generated by JavaScript -->
        </div>
    </div>


    <!-- Forecast Section -->
    <div class="forecast-section">
        <div class="forecast-header">
            <div class="forecast-title">7-Day Forecast</div>
            <div class="view-toggle">
                <button class="toggle-btn active">Chart</button>
                <button class="toggle-btn">List</button>
            </div>
        </div>
        <div class="forecast-cards">
            <!-- Day 1 -->
            <div class="forecast-card">
                <div class="day">Mon</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">19°C</div>
                <div class="temp-low">12°C</div>
            </div>
            <!-- Day 2 -->
            <div class="forecast-card">
                <div class="day">Tue</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">17°C</div>
                <div class="temp-low">11°C</div>
            </div>
            <!-- Day 3 -->
            <div class="forecast-card">
                <div class="day">Wed</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-rain" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">15°C</div>
                <div class="temp-low">10°C</div>
            </div>
            <!-- Day 4 -->
            <div class="forecast-card">
                <div class="day">Thu</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-showers-heavy" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">14°C</div>
                <div class="temp-low">9°C</div>
            </div>
            <!-- Day 5 -->
            <div class="forecast-card">
                <div class="day">Fri</div>
                <div class="forecast-icon">
                    <i class="fas fa-cloud-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">16°C</div>
                <div class="temp-low">10°C</div>
            </div>
            <!-- Day 6 -->
            <div class="forecast-card">
                <div class="day">Sat</div>
                <div class="forecast-icon">
                    <i class="fas fa-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">18°C</div>
                <div class="temp-low">12°C</div>
            </div>
            <!-- Day 7 -->
            <div class="forecast-card">
                <div class="day">Sun</div>
                <div class="forecast-icon">
                    <i class="fas fa-sun" style="color: var(--accent-color);"></i>
                </div>
                <div class="temp-high">20°C</div>
                <div class="temp-low">13°C</div>
            </div>
        </div>
    </div>

</div>

<!-- Include the external JavaScript file -->
{#<script src="{{ url_for('static', filename='js/app.js') }}"></script>#}
<script>





const hourly = {{ hourly | tojson | safe }}
const hourlyWeatherArray = hourly.hourly_data;

// Map initialization
var map = L.map('map').setView([{{city_info.lat}}, {{city_info.lon}}], 5);

// Base map
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '© OpenStreetMap',
    maxZoom: 10
}).addTo(map);

// Weather overlay
L.tileLayer('{{ tile_url }}', {
    maxZoom: 18,
    opacity: 1
}).addTo(map);

// Fix map display issue by triggering a resize event after the map is loaded
setTimeout(function() {
    map.invalidateSize();
}, 100);



document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabs = document.querySelectorAll('.tab');
    const chartContainers = document.querySelectorAll('.weather-forecast-chart');
    const listView = document.querySelector('.forecast-list-view');

    tabs.forEach((tab, index) => {
        tab.addEventListener('click', function() {
            // Update active tab
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            // Hide all charts
            chartContainers.forEach(chart => chart.classList.remove('active'));

            // Show the corresponding chart based on tab index
            const tabText = this.textContent.trim().toLowerCase();

            // Hide list view and show charts container
            listView.style.display = 'none';
            document.querySelector('.forecast-charts-container').style.display = 'block';

            // Show the appropriate chart based on the tab text
            if (tabText === 'overview') {
                document.getElementById('overview-chart').classList.add('active');
            } else if (tabText === 'precipitation') {
                document.getElementById('precipitation-chart').classList.add('active');
            } else if (tabText === 'wind') {
                document.getElementById('wind-chart').classList.add('active');
            } else if (tabText === 'air quality') {
                document.getElementById('air-quality-chart').classList.add('active');
            } else if (tabText === 'humidity') {
                document.getElementById('humidity-chart').classList.add('active');
            } else if (tabText === 'cloud cover') {
                document.getElementById('cloud-cover-chart').classList.add('active');
            }
        });
    });

    // Toggle buttons for Chart/List view
    const toggleBtns = document.querySelectorAll('.toggle-btn');
    const forecastChartsContainer = document.querySelector('.forecast-charts-container');

    toggleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            toggleBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            const viewType = this.textContent.trim().toLowerCase();

            if (viewType === 'chart') {
                forecastChartsContainer.style.display = 'block';
                listView.style.display = 'none';
            } else if (viewType === 'list') {
                forecastChartsContainer.style.display = 'none';
                listView.style.display = 'block';

                // Generate list items if they don't exist
                if (listView.querySelector('.forecast-list-container').children.length === 0) {
                    generateForecastListItems();
                }
            }
        });
    });

    // Initialize all charts
    initTemperatureChart();
    initPrecipitationChart();
    initWindChart();
    initAirQualityChart();
    initHumidityChart();
    initCloudCoverChart();

    // Initialize map
    initMap();
});

// Common functions
function generateTimeLabels() {
    const labels = [];
    const now = new Date();
    const currentHour = now.getHours();

    for (let i = 0; i < 13; i++) {
        const hour = (currentHour + i * 2) % 24;
        const formattedHour = i === 0 ? 'Now' : `${hour}:00`;
        labels.push(formattedHour);
    }

    return labels;
}




function addWeatherIcons(container, icons, values, unit = '') {
    // Create container for icons
    const iconContainer = document.createElement('div');
    iconContainer.className = 'weather-icons-container';

    // Add icons
    icons.forEach((icon, index) => {
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'weather-icon';

        const iconElement = document.createElement('i');
        iconElement.className = `fas fa-${icon}`;

        const valueLabel = document.createElement('div');
        valueLabel.className = 'temp-label';
        valueLabel.textContent = `${values[index]}${unit}`;

        iconWrapper.appendChild(iconElement);
        iconWrapper.appendChild(valueLabel);
        iconContainer.appendChild(iconWrapper);
    });

    container.appendChild(iconContainer);
}

function addNowIndicator(container) {
    // Create indicator line
    const indicator = document.createElement('div');
    indicator.className = 'now-indicator';

    // Create "Now" label
    const label = document.createElement('div');
    label.className = 'now-label';
    label.textContent = 'Now';

    container.appendChild(indicator);
    container.appendChild(label);
}

// Function to generate forecast list items
function generateForecastListItems() {
    const listContainer = document.querySelector('.forecast-list-container');
    const timeLabels = generateTimeLabels();

    {#// Hardcoded temperature data#}
    {#const temperatureData = [22.5, 24.1, 25.7, 26.3, 25.8, 24.2, 22.9, 21.5, 20.1, 19.3, 18.7, 18.2, 17.9];#}
    {##}
    {#// Hardcoded weather icons based on temperature#}
    {#const weatherIcons = ['sun', 'sun', 'sun', 'cloud-sun', 'cloud-sun', 'cloud', 'cloud', 'cloud-rain', 'cloud-rain', 'cloud-showers-heavy', 'cloud-showers-heavy', 'cloud', 'cloud'];#}

    // Clear existing items
    listContainer.innerHTML = '';

    // Create list items
    timeLabels.forEach((time, index) => {
        const listItem = document.createElement('div');
        listItem.className = 'forecast-list-item';

        const timeElement = document.createElement('div');
        timeElement.className = 'forecast-list-time';
        timeElement.textContent = time;

        const iconElement = document.createElement('div');
        iconElement.className = 'forecast-list-icon';
        const icon = document.createElement('i');
        icon.className = `fas fa-${weatherIcons[index]}`;
        iconElement.appendChild(icon);

        const tempElement = document.createElement('div');
        tempElement.className = 'forecast-list-temp';
        tempElement.textContent = `${temperatureData[index]}°C`;

        listItem.appendChild(timeElement);
        listItem.appendChild(iconElement);
        listItem.appendChild(tempElement);

        listContainer.appendChild(listItem);
    });
}


// Precipitation Chart
function initPrecipitationChart() {
    const ctx = document.getElementById('precipitationChart').getContext('2d');
    const chartContainer = document.getElementById('precipitation-chart').querySelector('.chart-container');
    const timeLabels = generateTimeLabels();

    // Hardcoded precipitation data (0-100%)
    const precipitationData = [10, 15, 25, 45, 65, 70, 55, 40, 30, 20, 15, 10, 5];

    // Create gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(0, 119, 255, 0.7)');
    gradient.addColorStop(1, 'rgba(0, 119, 255, 0.1)');

    const chartConfig = {
        type: 'line',
        data: {
            labels: timeLabels,
            datasets: [{
                label: 'Precipitation (%)',
                data: precipitationData,
                borderColor: '#0077ff',
                backgroundColor: gradient,
                borderWidth: 3,
                pointBackgroundColor: '#0077ff',
                pointBorderColor: '#0077ff',
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(22, 27, 34, 0.9)',
                    titleColor: '#f0f6fc',
                    bodyColor: '#f0f6fc',
                    borderColor: '#30363d',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            return `Precipitation: ${context.parsed.y}%`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 }
                    }
                },
                y: {
                    min: 0,
                    max: 100,
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 },
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    };

    const precipitationChart = new Chart(ctx, chartConfig);

    // Add icons based on precipitation values
    const icons = precipitationData.map(value => {
        if (value < 20) return 'sun';
        if (value < 40) return 'cloud-sun';
        if (value < 60) return 'cloud';
        if (value < 80) return 'cloud-rain';
        return 'cloud-showers-heavy';
    });

    addWeatherIcons(chartContainer, icons, precipitationData, '%');
    addNowIndicator(chartContainer);
}

// Wind Chart
function initWindChart() {
    const ctx = document.getElementById('windChart').getContext('2d');
    const chartContainer = document.getElementById('wind-chart').querySelector('.chart-container');
    const timeLabels = generateTimeLabels();

    // Hardcoded wind data (0-50 km/h)
    const windData = [15, 18, 22, 25, 30, 35, 32, 28, 25, 20, 18, 15, 12];

    // Create gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(0, 200, 100, 0.7)');
    gradient.addColorStop(1, 'rgba(0, 200, 100, 0.1)');

    const chartConfig = {
        type: 'line',
        data: {
            labels: timeLabels,
            datasets: [{
                label: 'Wind Speed (km/h)',
                data: windData,
                borderColor: '#00c864',
                backgroundColor: gradient,
                borderWidth: 3,
                pointBackgroundColor: '#00c864',
                pointBorderColor: '#00c864',
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(22, 27, 34, 0.9)',
                    titleColor: '#f0f6fc',
                    bodyColor: '#f0f6fc',
                    borderColor: '#30363d',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            return `Wind Speed: ${context.parsed.y} km/h`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 }
                    }
                },
                y: {
                    min: 0,
                    max: 50,
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 },
                        callback: function(value) {
                            return value + ' km/h';
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    };

    const windChart = new Chart(ctx, chartConfig);

    // Add wind icons
    const icons = windData.map(value => 'wind');

    addWeatherIcons(chartContainer, icons, windData, ' km/h');
    addNowIndicator(chartContainer);
}

// Air Quality Chart
function initAirQualityChart() {
    const ctx = document.getElementById('airQualityChart').getContext('2d');
    const chartContainer = document.getElementById('air-quality-chart').querySelector('.chart-container');
    const timeLabels = generateTimeLabels();

    // Hardcoded air quality data (1-5, where 1 is good and 5 is very poor)
    const airQualityData = [1.5, 1.8, 2.2, 2.5, 3.0, 3.2, 2.8, 2.5, 2.2, 2.0, 1.8, 1.5, 1.3];

    // Create gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(255, 99, 132, 0.7)');
    gradient.addColorStop(1, 'rgba(255, 99, 132, 0.1)');

    const chartConfig = {
        type: 'line',
        data: {
            labels: timeLabels,
            datasets: [{
                label: 'Air Quality Index',
                data: airQualityData,
                borderColor: '#ff6384',
                backgroundColor: gradient,
                borderWidth: 3,
                pointBackgroundColor: '#ff6384',
                pointBorderColor: '#ff6384',
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(22, 27, 34, 0.9)',
                    titleColor: '#f0f6fc',
                    bodyColor: '#f0f6fc',
                    borderColor: '#30363d',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            const value = context.parsed.y;
                            let quality = 'Unknown';
                            if (value <= 1) quality = 'Good';
                            else if (value <= 2) quality = 'Fair';
                            else if (value <= 3) quality = 'Moderate';
                            else if (value <= 4) quality = 'Poor';
                            else quality = 'Very Poor';
                            return `Air Quality: ${quality} (${value})`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 }
                    }
                },
                y: {
                    min: 1,
                    max: 5,
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 },
                        callback: function(value) {
                            let quality = 'Unknown';
                            if (value <= 1) quality = 'Good';
                            else if (value <= 2) quality = 'Fair';
                            else if (value <= 3) quality = 'Moderate';
                            else if (value <= 4) quality = 'Poor';
                            else quality = 'Very Poor';
                            return quality;
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    };

    const airQualityChart = new Chart(ctx, chartConfig);

    // Add icons based on air quality values
    const icons = airQualityData.map(value => {
        if (value <= 1) return 'smile';
        if (value <= 2) return 'meh';
        if (value <= 3) return 'meh';
        if (value <= 4) return 'frown';
        return 'dizzy';
    });

    addWeatherIcons(chartContainer, icons, airQualityData, '');
    addNowIndicator(chartContainer);
}

// Humidity Chart
function initHumidityChart() {
    const ctx = document.getElementById('humidityChart').getContext('2d');
    const chartContainer = document.getElementById('humidity-chart').querySelector('.chart-container');
    const timeLabels = generateTimeLabels();

    // Hardcoded humidity data (30-100%)
    const humidityData = [65, 70, 75, 80, 85, 80, 75, 70, 65, 60, 55, 50, 45];

    // Create gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(54, 162, 235, 0.7)');
    gradient.addColorStop(1, 'rgba(54, 162, 235, 0.1)');

    const chartConfig = {
        type: 'line',
        data: {
            labels: timeLabels,
            datasets: [{
                label: 'Humidity (%)',
                data: humidityData,
                borderColor: '#36a2eb',
                backgroundColor: gradient,
                borderWidth: 3,
                pointBackgroundColor: '#36a2eb',
                pointBorderColor: '#36a2eb',
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(22, 27, 34, 0.9)',
                    titleColor: '#f0f6fc',
                    bodyColor: '#f0f6fc',
                    borderColor: '#30363d',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            return `Humidity: ${context.parsed.y}%`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 }
                    }
                },
                y: {
                    min: 0,
                    max: 100,
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 },
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    };

    const humidityChart = new Chart(ctx, chartConfig);

    // Add icons based on humidity values
    const icons = humidityData.map(value => {
        if (value < 40) return 'sun';
        if (value < 60) return 'cloud-sun';
        if (value < 80) return 'cloud';
        return 'tint';
    });

    addWeatherIcons(chartContainer, icons, humidityData, '%');
    addNowIndicator(chartContainer);
}

// Cloud Cover Chart
function initCloudCoverChart() {
    const ctx = document.getElementById('cloudCoverChart').getContext('2d');
    const chartContainer = document.getElementById('cloud-cover-chart').querySelector('.chart-container');
    const timeLabels = generateTimeLabels();

    // Hardcoded cloud cover data (0-100%)
    const cloudCoverData = [20, 30, 45, 60, 75, 85, 70, 55, 40, 30, 25, 20, 15];

    // Create gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(153, 102, 255, 0.7)');
    gradient.addColorStop(1, 'rgba(153, 102, 255, 0.1)');

    const chartConfig = {
        type: 'line',
        data: {
            labels: timeLabels,
            datasets: [{
                label: 'Cloud Cover (%)',
                data: cloudCoverData,
                borderColor: '#9966ff',
                backgroundColor: gradient,
                borderWidth: 3,
                pointBackgroundColor: '#9966ff',
                pointBorderColor: '#9966ff',
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(22, 27, 34, 0.9)',
                    titleColor: '#f0f6fc',
                    bodyColor: '#f0f6fc',
                    borderColor: '#30363d',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            return `Cloud Cover: ${context.parsed.y}%`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 }
                    }
                },
                y: {
                    min: 0,
                    max: 100,
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: { size: 12 },
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    };

    const cloudCoverChart = new Chart(ctx, chartConfig);

    // Add icons based on cloud cover values
    const icons = cloudCoverData.map(value => {
        if (value < 20) return 'sun';
        if (value < 40) return 'cloud-sun';
        if (value < 70) return 'cloud';
        if (value < 90) return 'cloud-rain';
        return 'cloud-showers-heavy';
    });

    addWeatherIcons(chartContainer, icons, cloudCoverData, '%');
    addNowIndicator(chartContainer);
}

// Map initialization
function initMap() {
    // Fix map display issue by triggering a resize event after the map is loaded
    setTimeout(function() {
        if (window.map) {
            window.map.invalidateSize();
        }
    }, 100);
}


// Temperature Chart
function initTemperatureChart() {

    let temperatureData = [];
    let feelsLikeData = [];
    let weatherIcons = [];
    // Get the canvas element
    const ctx = document.getElementById('temperatureChart').getContext('2d');
    const chartContainer = document.getElementById('overview-chart').querySelector('.chart-container');

    // Generate time labels (24 hours, in 2-hour steps)
    console.log("Hourly is:", hourly);
    console.log("Type of hourly is:", typeof hourly);


    const timeLabels = Array.isArray(hourly.hourly_data)
        ? hourly.hourly_data.map(d => {
            if (!d.timestamp || typeof d.timestamp !== 'number') {
                console.error("Invalid timestamp in hourly_data:", d);
                return null; // Handle invalid entries gracefully
            }
            const date = new Date(d.timestamp * 1000);
            return `${date.getHours()}:00`;
        }).filter(label => label !== null) // Remove any invalid labels that were returned as null
        : []; // Fallback in case hourly_data is not an array

    if (!hourly || !Array.isArray(hourly.hourly_data)) {
       console.error("hourly.hourly_data is not an array or is undefined.");
    } else {
        temperatureData = hourly.hourly_data.map(d => d.temperature);
        console.log(temperatureData);
        feelsLikeData = hourly.hourly_data.map(d => d.feels_like);
        console.log(feelsLikeData);
       }

    // Hardcoded weather condition icons

    if (!hourly || !Array.isArray(hourly.hourly_data)) {
       console.error("hourly.hourly_data is not an array or is undefined.");
    } else {
        weatherIcons = hourly.hourly_data.map(d => {
        if (d.clouds && d.clouds.toLowerCase().includes('cloud')) return 'cloud';
        return 'sun';  // fallback
    });

    }


    // Create gradient for the area under the curve
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(255, 183, 0, 0.7)');
    gradient.addColorStop(1, 'rgba(255, 183, 0, 0.1)');

    // Calculate minimum y-axis value for temperature chart
    const minTemperature = Math.min(...temperatureData);
    const yAxisMin = minTemperature - 10;

    // Create chart configuration
    const chartConfig = {
        type: 'line',
        data: {
            labels: timeLabels,
            datasets: [
                {
                    label: 'Temperature (°C)',
                    data: temperatureData,
                    borderColor: '#ffb700',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    pointBackgroundColor: '#ffb700',
                    pointBorderColor: '#ffb700',
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Feels Like (°C)',
                    data: feelsLikeData,
                    borderColor: 'rgba(255, 255, 255, 0.6)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(255, 255, 255, 0.6)',
                    pointBorderColor: 'rgba(255, 255, 255, 0.6)',
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    tension: 0.4,
                    fill: false,
                    hidden: false
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(22, 27, 34, 0.9)',
                    titleColor: '#f0f6fc',
                    bodyColor: '#f0f6fc',
                    borderColor: '#30363d',
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            const datasetLabel = context.dataset.label || '';
                            const value = context.parsed.y;
                            return `${datasetLabel}: ${value}°C`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: {
                            size: 12
                        }
                    }
                },
                y: {
                    min: yAxisMin,
                    max: 35,
                    grid: {
                        color: 'rgba(48, 54, 61, 0.5)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#8b949e',
                        font: {
                            size: 12
                        },
                        callback: function(value) {
                            return value + '°C';
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    };

    // Create the chart
    const temperatureChart = new Chart(ctx, chartConfig);

    // Add weather icons to the chart
    addWeatherIcons(chartContainer, weatherIcons, temperatureData, '°');

    // Add "Now" indicator
    addNowIndicator(chartContainer);

    // Add event listener for the "Feels Like" toggle
    document.getElementById('feelsLikeToggle').addEventListener('change', function() {
        const feelsLikeDataset = temperatureChart.data.datasets[1];
        feelsLikeDataset.hidden = !this.checked;
        temperatureChart.update();
    });
}


</script>

</body>
</html>'
